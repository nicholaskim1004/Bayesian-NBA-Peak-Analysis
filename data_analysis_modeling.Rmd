---
title: "final_proj"
author: "Nick Kim"
date: "2025-11-27"
output: pdf_document
---

## Data Analysis

```{r}
nba <- read.csv("/Users/nicholaskim/Documents/STAT 551/final proj/Data/peaks.csv")

nba <- nba[,-1]
```


Making plots to help with setting priors

```{r}
library(ggplot2)
library(dplyr)

tier_order <- numeric(nrow(nba))

for (i in 1:nrow(nba)){
  if (nba$Player.Tier[i] == "All Time Great"){
    tier_order[i] = 1
  }
  else if (nba$Player.Tier[i] == "MVP"){
    tier_order[i] = 2
  }
  else if (nba$Player.Tier[i] == "All-NBA"){
    tier_order[i] = 3
  }
  else if (nba$Player.Tier[i] == "All-Star"){
    tier_order[i] = 4
  }
  else if (nba$Player.Tier[i] == "Good Starter"){
    tier_order[i] = 5
  }
  else if (nba$Player.Tier[i] == "Role Player"){
    tier_order[i] = 6
  }
  else if (nba$Player.Tier[i] == "Replacement Level"){
    tier_order[i] = 7
  }
  else{
    tier_order[i] = 8
  }
}

nba$Tier_ord <- tier_order

ggplot(data = nba, aes(x = Country, fill = reorder(Player.Tier,Tier_ord))) + 
  geom_bar(position = "fill") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) + 
  labs(title = "Proportional Distribution of Tiers by Country",
       x = "Country",
       y = "Proportion",
       fill = "Tiers")

```
US, Spain, Turkey, France, and Serbia have very similar distributions with an even spread of players across tiers. An interesting thing to notice is that you only really see top talent (all-nba and above) coming from the countries with top leagues in the world.

```{r}
table(nba$Country)
```
Let's look at differences in leagues within a handful of countries we have data for
```{r}
usa <- subset(nba, Country == "USA")
spain <- subset(nba, Country == "Spain")

ggplot(data = usa, aes(x = reorder(League,League.Diff), fill = reorder(Player.Tier,Tier_ord))) + 
  geom_bar(position = "fill") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  labs(title = "Proportional Distribution of Tiers by League in USA",
       x = "Leagues",
       y = "Proportion",
       fill = "Tiers")

print(table(usa$League))

ggplot(data = spain, aes(x = League, fill = reorder(Player.Tier,Tier_ord))) + 
  geom_bar(position = "fill") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) + 
  labs(title = "Proportional Distribution of Tiers by League in Spain",
       x = "Leagues",
       y = "Proportion",
       fill = "Tiers")

print(table(spain$League))
```
For high school there is a selection bias in my data since the NBA stopped drafted high school players in the early 2000's and I pulled information on players who played up until 5 years ago. This means that those high school players who were significant contributors of had long successful careers where the ones that made it into my data while their other piers won't be captured.

In either case, the difference in leagues mostly seems to come in the number of all time great to all-nba talent that is produced.

```{r}
league_tier_plt <- ggplot(data = nba, aes(x = reorder(League, League.Diff), fill = reorder(Player.Tier,Tier_ord))) + 
  geom_bar(position = "fill") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  labs(title = "Proportional Distribution of Tiers by League",
       x = "Leagues",
       y = "Proportion",
       fill = "Tiers")

ggsave("plots/league_tier_plt.png",league_tier_plt, width=10, height=7)

league_tier_plt
```

```{r}
ggplot(data = subset(nba,League=="Top D1"), aes(x = Round.Bin, fill = reorder(Player.Tier,Tier_ord))) + 
  geom_bar(position = "fill") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  labs(title = "Proportional Distribution of Tiers by League",
       x = "Pick Bin",
       y = "Proportion",
       fill = "Tiers")
```


Lastly, lets take a look at draft position and its effect
```{r}
act_tier_prop_round <- ggplot(data = nba, aes(x = Round.Bin, fill = reorder(Player.Tier,Tier_ord))) + 
  geom_bar(position = "fill") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  labs(title = "Proportional Distribution of Tiers by Round",
       x = "Pick Bin",
       y = "Proportion",
       fill = "Tiers")

act_tier_prop_round


ggplot(data = usa, aes(x = Round.Bin, fill = reorder(Player.Tier,Tier_ord))) + 
  geom_bar(position = "fill") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  labs(title = "Proportional Distribution of Tiers by Round",
       x = "Pick Bin",
       y = "Proportion",
       fill = "Tiers")


ggplot(data = spain, aes(x = Round.Bin, fill = reorder(Player.Tier,Tier_ord))) + 
  geom_bar(position = "fill") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  labs(title = "Proportional Distribution of Tiers by Round",
       x = "Pick Bin",
       y = "Proportion",
       fill = "Tiers")

act_pick_prop_league <- ggplot(data = nba, aes(x = reorder(League_red, Leage_diff_red), fill = Round.Bin)) + 
  geom_bar(position = "fill") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  labs(title = "Proportional Distribution of Pick Bin by League",
       x = "Leagues",
       y = "Proportion",
       fill = "Pick Bin")

act_pick_prop_league

bpm_by_pick_d1<-ggplot(data = subset(nba, League == "Top D1"), aes(x = Round.Bin, fill = reorder(Player.Tier,Tier_ord))) + 
  geom_bar(position = "fill") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1) )+
  labs(title = "Proportional Distribution of Player Tier by Pick Bin for Top D1",
       x = "Pick Bin",
       y = "Proportion",
       fill = "Tier")

ggsave("plots/bpm_pick_d1.png", bpm_by_pick_d1, height = 7, width = 10)

bpm_by_pick_d1

bpm_by_pick_euro<- ggplot(data = subset(nba, League_red == "Europe Elite"), aes(x = Round.Bin, fill = reorder(Player.Tier,Tier_ord))) + 
  geom_bar(position = "fill") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  labs(title = "Proportional Distribution of Player Tier by Pick Bin for Europe Elite",
       x = "Pick Bin",
       y = "Proportion",
       fill = "Tier")
ggsave("plots/bpm_pick_euro.png", bpm_by_pick_euro, height = 7, width = 10)

bpm_by_pick_euro
```

Similar, to the other plots, as we move further away from places where we'd expect top talent less is produced. If we were to disregard the selection bias in high school we can see in the us bar charts that as league difficulty gets weaker there are a high proportion of Undrafted players. This is more clear in the Spain example, where high school is filtered out.


Key insights:
- League difficulty matters in terms of generating elite/generational talent
- Same goes for Round.Bin 

These variables should then have their own effect to capture should differences

Looking at Bust rates
```{r}
print(prop.table(table(nba$Round.Bin,nba$Met.Draft.Expt)))
print(table(nba$Round.Bin,nba$Met.Draft.Expt))
```

Age of players across Round

```{r}
nba %>% select(Round.Bin, Age.Enter) %>% group_by(Round.Bin) %>% 
  summarise(mean_age = mean(Age.Enter),
            med_age = median(Age.Enter))
nba %>% select(Round.Bin, League, Age.Enter) %>% group_by(League, Round.Bin) %>% 
  summarise(mean_age = mean(Age.Enter),
            med_age = median(Age.Enter))
```


Age of Peaks

```{r}
print(mean(nba$Age.Peaked))
print(median(nba$Age.Peaked))
print(quantile(nba$Age.Peaked,c(.25,.75)))
```

From the ages we can see that younger players with more potential are picked earlier and generally they reach their peaks in the prime ages of their career of 22-26.

```{r}
ggplot(data = nba, aes(x = Top.3.BPM.Avg, fill =Round.Bin))+
  geom_histogram(bins = 25) +
  labs(title = "Distribution of BPM by Round Bin",
       x = "Avg BPM",
       y = "Count",
       fill = "Pick Bin")


ggplot(data = subset(nba, League == "Top D1"), aes(x = Top.3.BPM.Avg, fill =Round.Bin))+
  geom_histogram(bins = 25)+
  labs(title = "Distribution of BPM by Round Bin for Top D1",
       x = "Avg BPM",
       y = "Count",
       fill = "Pick Bin")



ggplot(data = subset(nba, League == "Euroleague"), aes(x = Top.3.BPM.Avg, fill =Round.Bin))+
  geom_histogram(bins = 25)+
  labs(title = "Distribution of BPM by Round Bin for Euroleague",
       x = "Avg BPM",
       y = "Count",
       fill = "Pick Bin")

```

```{r}
ggplot(data = nba, aes(x = Draft.Pick, y = Top.3.BPM.Avg, colour = League_red))+
  geom_point()
```

## Data Modeling

brms


Combining leagues together so there'll be less sparsity

```{r}
reduced_leagues <- numeric(nrow(nba))

dev_leg <- c("G League","International Prep","Overtime")

other <- c("CBA","Israeli Premier League","JUCO","Super League 1","VTB United League")

south_america <- c("NBB","LUB")

europe_lower <- c("Primera FEB","Serie B","Nationale Masculine 1","LNB Pro B","Greek B","LKL","BSL")

europe_top_league <- c("Serie A","Bundesliga","Super Ligi")

for (i in 1:nrow(nba)){
  league = nba$League[i]
  
  if (league %in% dev_leg){
    reduced_leagues[i] = "Developmental League"
  }
  else if (league %in% south_america){
    reduced_leagues[i] = "South America"
  }
  else if (league %in% europe_top_league){
    reduced_leagues[i] = "Other Top Europe"
  }
  else if (league %in% europe_lower){
    reduced_leagues[i] = "Other Europe Lower"
  }
  else if (league == "Top D1"){
    reduced_leagues[i] = "Top D1"
  }
  else if (league == "Other D1"){
    reduced_leagues[i] = "Other D1"
  }
  else if (league == "Euroleague"){
    reduced_leagues[i] = "Europe Elite"
  }
  else if (league %in% other){
    reduced_leagues[i] = "Other"
  }
  else if (league == "ABA"){
    reduced_leagues[i] = "Eastern Europe Top"
  }
  else if (league == "Liga ACB"){
    reduced_leagues[i] = "Spain Top"
  }
  else if (league == "LNB Pro A"){
    reduced_leagues[i] = "France Top"
  }
  else if (league == "High School"){
    reduced_leagues[i] = "High School"
  }
  else if (league == "NBL"){
    reduced_leagues[i] = "Australia Top"
  }
}

nba$League_red <- factor(reduced_leagues)

nba$League.Diff <- as.numeric(nba$League.Diff)
league_diff_adj <- nba %>% select(League_red, League.Diff) %>% group_by(League_red) %>% summarise(Leage_diff_red = mean(League.Diff))

nba <- merge(nba,league_diff_adj,by="League_red")

league_raw <- (13 + 1 - nba$Leage_diff_red)  # invert so higher = more difficult
league_diff_std <- scale(league_raw)[,1] 

nba$League_red_adj <- league_diff_std

league_raw <- (28 + 1 - nba$League.Diff)  # invert so higher = more difficult
league_diff_std <- scale(league_raw)[,1] 
nba$League_adj <- league_diff_std

nba$Draft.Pick[nba$Draft.Pick == 0] <- 65
```

```{r}
tier_league <- ggplot(data = nba, aes(x = reorder(League_red, League_red_adj, decreasing=TRUE), fill = reorder(Player.Tier,Tier_ord))) + 
  geom_bar(position = "fill") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  labs(title = "Proportional Distribution of Tiers by League",
       x = "Leagues",
       y = "Proportion",
       fill = "Tiers")

ggsave("plots/prop_tiers_leauge_red.png",tier_league,width=10, height=7)
```


```{r}
library(brms)

nba$Round.Bin <- factor(nba$Round.Bin)

priors = c(
    prior(student_t(4, 0, 5), class = Intercept),
    prior(normal(0, 1), class = sd),       # hierarchical sd
    prior(normal(0, 1), class = b)
  )


bpm_reg <- brm(
    Top.3.BPM.Avg ~ 1 + Age.Enter + League_red_adj + Draft.Pick + (1 | League_red),
    data = nba,
    family = student(),
    prior = priors, chains = 4, iter = 10000
)


```

```{r}
summary(bpm_reg)
```


```{r}
pp<-posterior_predict(bpm_reg)
```

Gonna used these predicted values to place them into different tiers. The cut offs for the tiers are the following:
- All Time Great: 10 >
- MVP: 7.5-10
- All-NBA: 5-7.5
- All-Star: 3.7-5
- Good Starter: 2-3.7
- Role Player: 0-2
- Replacement Level: -2-0
- Benchwarmer: < -2

```{r}
pp_tiers <- matrix(0,nrow = nrow(pp), ncol = ncol(pp))
  
for (player in 1:ncol(pp)){
  player_pred_bpms = pp[,player]
  for (i in 1:nrow(pp)){
    pred_bpm = player_pred_bpms[i]
    
    if (pred_bpm > 10){
      pp_tiers[i,player] = "All Time Great"
    }
    else if ((pred_bpm <= 10) & (pred_bpm > 7.5)){
      pp_tiers[i,player] = "MVP"
    }
    else if ((pred_bpm <= 7.5) & (pred_bpm > 5)){
      pp_tiers[i,player] = "All-NBA"
    }
    else if ((pred_bpm <= 5) & (pred_bpm > 3.7)){
      pp_tiers[i,player] = "All-Star"
    }
    else if ((pred_bpm <= 3.7) & (pred_bpm > 2)){
      pp_tiers[i,player] = "Good Starter"
    }
    else if ((pred_bpm <= 2) & (pred_bpm > 0)){
      pp_tiers[i,player] = "Role Player"
    }
    else if ((pred_bpm <= 0) & (pred_bpm > -2)){
      pp_tiers[i,player] = "Replacement Level"
    }
    else{
      pp_tiers[i,player] = "Benchwarmer"
    }
  }
}
```

Get proportions of each tier for each player 
```{r}
count_by_tier_per_player <- matrix(0, nrow=ncol(pp), ncol=8)

for (player in 1:ncol(pp_tiers)){
  count_by_tier_per_player[player,] = table(factor(pp_tiers[, player], 
                                                   levels = c("All Time Great","All-NBA","All-Star","Benchwarmer","Good Starter","MVP","Replacement Level","Role Player")))
}

#transforming the matrix to be used for merging onto the nba dataframe

tier_counts_pp <- as.data.frame(count_by_tier_per_player)
colnames(tier_counts_pp) <- c("All Time Great","All-NBA","All-Star","Benchwarmer","Good Starter","MVP","Replacement Level","Role Player")
tier_counts_pp$Player <- nba$Player
tier_counts_pp$League <- nba$League_red
tier_counts_pp$Age <- nba$Age.Enter
tier_counts_pp$Pick <- nba$Draft.Pick
tier_counts_pp$Pick_bin <- nba$Round.Bin
tier_counts_pp$League_ord <- nba$League_red_adj
```


```{r}
library(tidyr)

tier_info <- tier_counts_pp %>%  
  pivot_longer(
    cols = "All Time Great":"Role Player", 
    names_to = "Tier",
    values_to = "Count"
)

tier_info <- tier_info %>% mutate(Tier_ord = factor(Tier, levels = c("All Time Great","MVP","All-NBA","All-Star","Good Starter","Role Player","Replacement Level","Benchwarmer")))

tier_league_plot <- ggplot(data = tier_info, aes(x = reorder(League,League_ord,decreasing=TRUE), y = Count, fill = Tier_ord)) + 
  geom_bar(stat = "identity", position = "fill") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))+
  labs(title = "Proportional Distribution of Player Tiers by League on Posterior",
       x = "Leagues",
       y = "Proportion",
       fill = "Tiers")

ggsave("plots/tier_league_post.png",tier_league_plot, height = 7, width = 10)

tier_league_plot
```


```{r}
tier_pick_post <- ggplot(data = tier_info, aes(x = Pick_bin, y = Count, fill = Tier_ord)) + 
  geom_bar(stat = "identity", position = "fill") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))+
  labs(title = "Proportional Distribution of Player Tiers by Pick Bin on Posterior",
       x = "Pick Bin",
       y = "Proportion",
       fill = "Tiers")

ggsave("plots/tier_pick_post.png",tier_pick_post, height = 7, width = 10)

tier_pick_post
```
```{r}
tier_pick_post_d1 <- ggplot(data = subset(tier_info,League == "Top D1"), aes(x = Pick_bin, y = Count, fill = Tier_ord)) + 
  geom_bar(stat = "identity", position = "fill") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))+
  labs(title = "Proportional Distribution of Player Tiers by Pick Bin for Top D1 on Posterior",
       x = "Leagues",
       y = "Proportion",
       fill = "Tiers")

ggsave("plots/tier_pick_post_d1.png",tier_pick_post_d1, height = 7, width = 10)

tier_pick_post_d1
```

Let's get bust rates

```{r}
exceed_rate <- numeric(nrow(tier_counts_pp))
met_rates <- numeric(nrow(tier_counts_pp))
bust_rates <- numeric(nrow(tier_counts_pp))

elite_rate <- numeric(nrow(tier_counts_pp))
floor_rate <- numeric(nrow(tier_counts_pp))
bum_rate <- numeric(nrow(tier_counts_pp))

for (i in 1:nrow(tier_counts_pp)){
  pick = tier_counts_pp$Pick[i]
  
  atg_c = tier_counts_pp$`All Time Great`[i]
  mvp_c = tier_counts_pp$MVP[i]
  allnba_c = tier_counts_pp$`All-NBA`[i]
  allstar_c = tier_counts_pp$`All-Star`[i]
  gs_c = tier_counts_pp$`Good Starter`[i]
  rp_c = tier_counts_pp$`Role Player`[i]
  replace_c = tier_counts_pp$`Replacement Level`[i]
  bench_c = tier_counts_pp$Benchwarmer[i]
  
  
  elite_rate[i] = (atg_c+mvp_c+allnba_c+allstar_c)/(atg_c+mvp_c+allnba_c+allstar_c+gs_c+rp_c+replace_c+bench_c)
  floor_rate[i] = (gs_c+rp_c)/(atg_c+mvp_c+allnba_c+allstar_c+gs_c+rp_c+replace_c+bench_c)
  bum_rate[i] = (replace_c+bench_c)/(atg_c+mvp_c+allnba_c+allstar_c+gs_c+rp_c+replace_c+bench_c)
  
  if (pick <= 14){
    exceed_rate[i] = (atg_c+mvp_c+allnba_c)/(atg_c+mvp_c+allnba_c+allstar_c+gs_c+rp_c+replace_c+bench_c)
    met_rates[i] = (allstar_c+gs_c)/(atg_c+mvp_c+allnba_c+allstar_c+gs_c+rp_c+replace_c+bench_c)
    bust_rates[i] = (rp_c+replace_c+bench_c)/(atg_c+mvp_c+allnba_c+allstar_c+gs_c+rp_c+replace_c+bench_c)
  }
  else if ((pick > 14) & (pick <= 30)){
    exceed_rate[i] = (atg_c+mvp_c+allnba_c+allstar_c)/(atg_c+mvp_c+allnba_c+allstar_c+gs_c+rp_c+replace_c+bench_c)
    met_rates[i] = (gs_c+rp_c)/(atg_c+mvp_c+allnba_c+allstar_c+gs_c+rp_c+replace_c+bench_c)
    bust_rates[i] = (replace_c+bench_c)/(atg_c+mvp_c+allnba_c+allstar_c+gs_c+rp_c+replace_c+bench_c)
  }
  else if ((pick > 30) & (pick <= 44)){
    exceed_rate[i] = (atg_c+mvp_c+allnba_c+allstar_c+gs_c)/(atg_c+mvp_c+allnba_c+allstar_c+gs_c+rp_c+replace_c+bench_c)
    met_rates[i] = (rp_c)/(atg_c+mvp_c+allnba_c+allstar_c+gs_c+rp_c+replace_c+bench_c)
    bust_rates[i] = (replace_c+bench_c)/(atg_c+mvp_c+allnba_c+allstar_c+gs_c+rp_c+replace_c+bench_c)
  }
  else if ((pick > 44) & (pick <= 60)){
    exceed_rate[i] = (atg_c+mvp_c+allnba_c+allstar_c+gs_c)/(atg_c+mvp_c+allnba_c+allstar_c+gs_c+rp_c+replace_c+bench_c)
    met_rates[i] = (rp_c+replace_c)/(atg_c+mvp_c+allnba_c+allstar_c+gs_c+rp_c+replace_c+bench_c)
    bust_rates[i] = (bench_c)/(atg_c+mvp_c+allnba_c+allstar_c+gs_c+rp_c+replace_c+bench_c)
  }
  else{
    exceed_rate[i] = (atg_c+mvp_c+allnba_c+allstar_c+gs_c+rp_c)/(atg_c+mvp_c+allnba_c+allstar_c+gs_c+rp_c+replace_c+bench_c)
    met_rates[i] = (replace_c+bench_c)/(atg_c+mvp_c+allnba_c+allstar_c+gs_c+rp_c+replace_c+bench_c)
    #can't really bust when there is no expectation for you to even play significantly
    bust_rates[i] = (0)/(atg_c+mvp_c+allnba_c+allstar_c+gs_c+rp_c+replace_c+bench_c)
  }
}



tier_counts_pp$Elite_rate <- elite_rate
tier_counts_pp$Floor_rate <- floor_rate
tier_counts_pp$Bum_rate <- bum_rate

tier_counts_pp$Exceed_rate <- exceed_rate
tier_counts_pp$Meet_rate <- met_rates
tier_counts_pp$Bust_rate <- bust_rates

```

Lets look at Elite and Bust rates grouped by different categories

```{r}
rate_league <- tier_counts_pp %>% group_by(League) %>% summarise(Age = mean(Age),
                                                  Elite_rate = mean(Elite_rate),
                                                  Floor_rate = mean(Floor_rate),
                                                  Bum_rate = mean(Bum_rate),
                                                  Exceed_rate = mean(Exceed_rate),
                                                  Met_rate = mean(Meet_rate),
                                                  Bust_rate = mean(Bust_rate))

rate_round <- tier_counts_pp %>% group_by(Pick_bin) %>% summarise(Age = mean(Age),
                                                  Elite_rate = mean(Elite_rate),
                                                  Floor_rate = mean(Floor_rate),
                                                  Bum_rate = mean(Bum_rate),
                                                  Exceed_rate = mean(Exceed_rate),
                                                  Met_rate = mean(Meet_rate),
                                                  Bust_rate = mean(Bust_rate))

rate_leauge_round <- tier_counts_pp %>% group_by(League,Pick_bin) %>% summarise(Age = mean(Age),
                                                  Elite_rate = mean(Elite_rate),
                                                  Floor_rate = mean(Floor_rate),
                                                  Bum_rate = mean(Bum_rate),
                                                  Exceed_rate = mean(Exceed_rate),
                                                  Met_rate = mean(Meet_rate),
                                                  Bust_rate = mean(Bust_rate))
```

## On NBA Draft Prospects


Creating NBA draft prospects data set. Some need to change college to one we have: Melbourne United, KK Partizan, Valencia Basket Club, South East Melbourne, Paris Basketball, Club Joventut, KK Mega
```{r}
nba_prospects <- data.frame(Player = c("AJ Dybantsa","Darryn Peterson","Cameron Boozer","Mikel Brown","Kingston Flemings","Caleb Wilson","Nate Ament","Karim Lopez","Isaiah Evans","Chris Cenac","Meleek Thomas","Labaron Philon","Dash Daniels","Cameron Carr","Hannes Steinbach","Brayden Burries","Darius Acuff","Matt Able","Thomas Haugh","Alijah Arenas","Yaxel Lendeborg","Bennett Stirtz","Patrick Ngongba","Ian Jackson","Tounde Yessoufou","Henri Vessaar","Miikka Muurinen","Koa Peat","Segio De Larrea","Miles Byrd","Zuby Ejiofor","Morez Johnson","JT Toppin","Karter Knox","PJ Haggerty","Adam Atamna","Richie Saunders","Baba Miller","Jaron Pierre","Tarris Reed","Nate Bittle","Malique Lewis","Milos Uzan","Baye Ndongo","Alex Karaban","Mouhamed Faye","Michael Ruzic","Mackenzie Mgbako","Tre White","Joshua Jefferson","Malique Ewin","Xaivian Lee","JJ Starling","Ognjen Srzentic","Braden Smith","Donovan Dent","Roddy Gayle","Kylan Boswell","Ryan Conwell","Denzel Aberdeen","Dame Sarr","Neoklis Avdalas","Flory Bidunga","Cayden Boozer","Dwayne Aristode"),
                            Age.Enter = c(18,18,18,19,18,19,19,18,20,18,19,20,17,21,19,20,19,18,22,18,23,22,19,20,19,21,18,18,20,21,21,19,20,20,21,18,24,21,23,22,22,21,22,22,23,20,19,21,22,21,22,21,21,18,22,22,22,20,21,21,19,19,20,18,19),
           College = c("Brigham Young","Kansas","Duke","Louisville","Houston","North Carolina","Tennessee","New Zealand Breakers","Duke","Houston","Arkansas","Alabama","Melbourne United","Baylor","Washington","Arizona","Arkansas","North Carolina State","Florida","USC","Michigan","Iowa","Duke","St. John's","Baylor","North Carolina","KK Partizan","Arizona","Valencia Basket Club","San Diego State","St. John's","Michigan","Texas Tech","Arkansas","Kansas State","ASVEL","Brigham Young","Cincinnati","Southern Methodist","Connecticut","Oregon","South East Melbourne","Houston","Georgia Tech","Connecticut","Paris Basketball","Club Joventut Badalona","Texas A&M","Kansas","Iowa State","Arkansas","Florida","Syracuse","KK Mega Leks","Purdue","UCLA","Michigan","Illinois","Louisville","Kentucky","Duke","Virginia Tech","Kansas","Duke","Arizona"),
           League_red = c(rep("Top D1",7),"Australia Top",rep("Top D1",4),"Australia Top",rep("Top D1",13),"Europe Elite","Top D1","Spain Top",rep("Top D1",6),"France Top",rep("Top D1",5),"Australia Top",rep("Top D1",3),"Europe Elite","Spain Top",rep("Top D1",6),"Eastern Europe Top",rep("Top D1",11)),
           Draft.Pick = c(1:60,rep(65,5)),
           Proj_Round_bin = c(rep("1-14",15),rep("15-30",15),rep("31-44",15),rep("45-60",15),rep("Undrafted",5)),
           League_red_adj = c(rep(0.4120414,7),0.2125225,rep(0.4120414,4),0.2125225,rep(0.4120414,13),0.8110791,0.4120414,0.6115603,rep(0.4120414,6),-0.7850718,rep(0.4120414,5),0.2125225,rep(0.4120414,3),0.8110791,0.6115603,rep(0.4120414,6),-1.5831473,rep(0.4120414,11)))
```

Getting posterior draws for these prospects

```{r}
prospects_pred <- posterior_predict(bpm_reg, newdata = nba_prospects)

pp_pros_tiers <- matrix(0,nrow = nrow(prospects_pred), ncol = ncol(prospects_pred))
  
for (player in 1:ncol(prospects_pred)){
  player_pred_bpms = prospects_pred[,player]
  for (i in 1:nrow(prospects_pred)){
    pred_bpm = player_pred_bpms[i]
    
    if (pred_bpm > 10){
      pp_pros_tiers[i,player] = "All Time Great"
    }
    else if ((pred_bpm <= 10) & (pred_bpm > 7.5)){
      pp_pros_tiers[i,player] = "MVP"
    }
    else if ((pred_bpm <= 7.5) & (pred_bpm > 5)){
      pp_pros_tiers[i,player] = "All-NBA"
    }
    else if ((pred_bpm <= 5) & (pred_bpm > 3.7)){
      pp_pros_tiers[i,player] = "All-Star"
    }
    else if ((pred_bpm <= 3.7) & (pred_bpm > 2)){
      pp_pros_tiers[i,player] = "Good Starter"
    }
    else if ((pred_bpm <= 2) & (pred_bpm > 0)){
      pp_pros_tiers[i,player] = "Role Player"
    }
    else if ((pred_bpm <= 0) & (pred_bpm > -2)){
      pp_pros_tiers[i,player] = "Replacement Level"
    }
    else{
      pp_pros_tiers[i,player] = "Benchwarmer"
    }
  }
}

```

```{r}
count_by_tier_prospect <- matrix(0, nrow=ncol(prospects_pred), ncol=8)

for (player in 1:ncol(pp_pros_tiers)){
  count_by_tier_prospect[player,] = table(factor(pp_pros_tiers[, player], 
                                                   levels = c("All Time Great","All-NBA","All-Star","Benchwarmer","Good Starter","MVP","Replacement Level","Role Player")))
}

#transforming the matrix to be used for merging onto the nba dataframe

tier_counts_prospects_pp <- as.data.frame(count_by_tier_prospect)
colnames(tier_counts_prospects_pp) <- c("All Time Great","All-NBA","All-Star","Benchwarmer","Good Starter","MVP","Replacement Level","Role Player")
tier_counts_prospects_pp$Player <- nba_prospects$Player
```

Can get probabilities of each tier and also get draft expectation counts
```{r}
tier_counts_prospects_pp$Pick <- nba_prospects$Draft.Pick

exceed_rate <- numeric(nrow(tier_counts_prospects_pp))
met_rates <- numeric(nrow(tier_counts_prospects_pp))
bust_rates <- numeric(nrow(tier_counts_prospects_pp))

elite_rate <- numeric(nrow(tier_counts_prospects_pp))
floor_rate <- numeric(nrow(tier_counts_prospects_pp))
bum_rate <- numeric(nrow(tier_counts_prospects_pp))

for (i in 1:nrow(tier_counts_prospects_pp)){
  pick = tier_counts_prospects_pp$Pick[i]
  
  atg_c = tier_counts_prospects_pp$`All Time Great`[i]
  mvp_c = tier_counts_prospects_pp$MVP[i]
  allnba_c = tier_counts_prospects_pp$`All-NBA`[i]
  allstar_c = tier_counts_prospects_pp$`All-Star`[i]
  gs_c = tier_counts_prospects_pp$`Good Starter`[i]
  rp_c = tier_counts_prospects_pp$`Role Player`[i]
  replace_c = tier_counts_prospects_pp$`Replacement Level`[i]
  bench_c = tier_counts_prospects_pp$Benchwarmer[i]
  
  
  elite_rate[i] = (atg_c+mvp_c+allnba_c+allstar_c)/(atg_c+mvp_c+allnba_c+allstar_c+gs_c+rp_c+replace_c+bench_c)
  floor_rate[i] = (gs_c+rp_c)/(atg_c+mvp_c+allnba_c+allstar_c+gs_c+rp_c+replace_c+bench_c)
  bum_rate[i] = (replace_c+bench_c)/(atg_c+mvp_c+allnba_c+allstar_c+gs_c+rp_c+replace_c+bench_c)
  
  if (pick <= 14){
    exceed_rate[i] = (atg_c+mvp_c+allnba_c)/(atg_c+mvp_c+allnba_c+allstar_c+gs_c+rp_c+replace_c+bench_c)
    met_rates[i] = (allstar_c+gs_c)/(atg_c+mvp_c+allnba_c+allstar_c+gs_c+rp_c+replace_c+bench_c)
    bust_rates[i] = (rp_c+replace_c+bench_c)/(atg_c+mvp_c+allnba_c+allstar_c+gs_c+rp_c+replace_c+bench_c)
  }
  else if ((pick > 14) & (pick <= 30)){
    exceed_rate[i] = (atg_c+mvp_c+allnba_c+allstar_c)/(atg_c+mvp_c+allnba_c+allstar_c+gs_c+rp_c+replace_c+bench_c)
    met_rates[i] = (gs_c+rp_c)/(atg_c+mvp_c+allnba_c+allstar_c+gs_c+rp_c+replace_c+bench_c)
    bust_rates[i] = (replace_c+bench_c)/(atg_c+mvp_c+allnba_c+allstar_c+gs_c+rp_c+replace_c+bench_c)
  }
  else if ((pick > 30) & (pick <= 44)){
    exceed_rate[i] = (atg_c+mvp_c+allnba_c+allstar_c+gs_c)/(atg_c+mvp_c+allnba_c+allstar_c+gs_c+rp_c+replace_c+bench_c)
    met_rates[i] = (rp_c)/(atg_c+mvp_c+allnba_c+allstar_c+gs_c+rp_c+replace_c+bench_c)
    bust_rates[i] = (replace_c+bench_c)/(atg_c+mvp_c+allnba_c+allstar_c+gs_c+rp_c+replace_c+bench_c)
  }
  else if ((pick > 44) & (pick <= 60)){
    exceed_rate[i] = (atg_c+mvp_c+allnba_c+allstar_c+gs_c)/(atg_c+mvp_c+allnba_c+allstar_c+gs_c+rp_c+replace_c+bench_c)
    met_rates[i] = (rp_c+replace_c)/(atg_c+mvp_c+allnba_c+allstar_c+gs_c+rp_c+replace_c+bench_c)
    bust_rates[i] = (bench_c)/(atg_c+mvp_c+allnba_c+allstar_c+gs_c+rp_c+replace_c+bench_c)
  }
  else{
    exceed_rate[i] = (atg_c+mvp_c+allnba_c+allstar_c+gs_c+rp_c)/(atg_c+mvp_c+allnba_c+allstar_c+gs_c+rp_c+replace_c+bench_c)
    met_rates[i] = (replace_c+bench_c)/(atg_c+mvp_c+allnba_c+allstar_c+gs_c+rp_c+replace_c+bench_c)
    #can't really bust when there is no expectation for you to even play significantly
    bust_rates[i] = (0)/(atg_c+mvp_c+allnba_c+allstar_c+gs_c+rp_c+replace_c+bench_c)
  }
}

tier_counts_prospects_pp$Elite_rate <- elite_rate
tier_counts_prospects_pp$Floor_rate <- floor_rate
tier_counts_prospects_pp$Bum_rate <- bum_rate

tier_counts_prospects_pp$Exceed_rate <- exceed_rate
tier_counts_prospects_pp$Meet_rate <- met_rates
tier_counts_prospects_pp$Bust_rate <- bust_rates

```







